<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>×—.×¡×‘×Ÿ ×—×•××¨×™ ×‘× ×™×Ÿ PWA</title>
    <meta name="theme-color" content="#14b8a6">
    <meta name="description" content="××¤×œ×™×§×¦×™×™×ª ×”×–×× ×•×ª ×œ×œ×§×•×—×•×ª ××–×“×× ×™× - ×—.×¡×‘×Ÿ">
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- React Router -->
    <script crossorigin src="https://unpkg.com/history@5/umd/history.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-router@6.3.0/umd/react-router.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-router-dom@6.3.0/umd/react-router-dom.production.min.js"></script>
    
    <!-- Babel (×œ×§×™××¤×•×œ JSX ×‘×“×¤×“×¤×Ÿ) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons (Lucide - Vanilla JS version) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Framer Motion (×œ×× ×™××¦×™×•×ª) -->
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>

    <!-- ×”×’×“×¨×•×ª ×¢×™×¦×•×‘ ××•×ª×××•×ª (Tailwind Config) -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        saban: {
                            50: '#f0fdfa',
                            100: '#ccfbf1',
                            500: '#14b8a6', // Teal Theme
                            600: '#0d9488',
                            800: '#115e59',
                            900: '#134e4a',
                        }
                    },
                    fontFamily: {
                        sans: ['Heebo', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Heebo', sans-serif; background-color: #f3f4f6; -webkit-tap-highlight-color: transparent; overscroll-behavior-y: none; }
        .glass { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-top: 1px solid rgba(255, 255, 255, 0.3); }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // --- Imports from Globals (CDN) ---
        const { useState, useEffect, useRef, useMemo } = React;
        const { HashRouter, Routes, Route, Link, useNavigate, useParams, useLocation } = ReactRouterDOM;
        const { motion, AnimatePresence } = window.Motion;
        
        // --- 1. DATA SEED (××¡×“ × ×ª×•× ×™× ××“×•××”) ---
        const PRODUCTS = [
            {
                id: 'p1',
                sku: 'QRTZ-001',
                title: '×©×§ ×§×•×•×¨×¦×™×ª (×’×¨× ×•×œ×™×˜) ×“×§',
                price: 45,
                category: '×—×•××¨×™ ××œ×™×˜×”',
                brand: '×‘×˜×•×Ÿ ×¢×˜×¨×•×ª',
                supplier: '×—.×¡×‘×Ÿ ××¡×¤×§×”',
                image: 'https://betonatarot.co.il/wp-content/uploads/2020/06/%D7%A9%D7%A7-%D7%A7%D7%95%D7%95%D7%A8%D7%A6%D7%99%D7%AA-17.5.2020-s-.jpg',
                description: '××’×¨×’×˜ ×§×•×•×¨×¥ ×˜×‘×¢×™ ×‘×’×•×•×Ÿ ×œ×‘×Ÿ/×§×¨×, ××©××© ×œ×™×¦×™×§×•×ª ×“×§×•×¨×˜×™×‘×™×•×ª, ×—×™×¤×•×™ ×’×¨× ×•×œ×™×˜ ×•×’×™× ×•×Ÿ. ×¢×•×‘×¨ ×©×˜×™×¤×” ×•× ×™×¤×•×™ ×§×¤×“× ×™.',
                features: ['×’×•×“×œ ×’×¨×’×¨: 1.2-2.5 ×"×', '××©×§×œ: 25 ×§"×’', '×¢××™×“×•×ª ×œ×©×—×™×§×”', '××ª××™× ×œ×—×•×¥ ×•×¤× ×™×'],
                technicalSpecs: {
                    coverage: '×›-50 ×§"×’ ×œ×"×¨ (×¢×•×‘×™ 2 ×¡"×)',
                    drying: '24 ×©×¢×•×ª ×¨××©×•× ×™, 7 ×™××™× ×¡×•×¤×™',
                    standard: '×ª"×™ 118'
                },
                stock: 150
            },
            {
                id: 'p2',
                sku: 'CMT-50',
                title: '××œ×˜ ××¤×•×¨ 50 ×§"×’',
                price: 28,
                category: '×—×•××¨×™ ××œ×™×˜×”',
                brand: '× ×©×¨',
                supplier: '× ×©×¨ ××¤×¢×œ×™ ××œ×˜',
                image: 'https://placehold.co/400x400/e2e8f0/1e293b?text=Cement', // Fallback image
                description: '××œ×˜ ×¤×•×¨×˜×œ× ×“ ××™×›×•×ª×™ ×œ×‘× ×™×™×” ×›×œ×œ×™×ª, ×˜×™×— ×•×™×¦×™×§×•×ª ×‘×˜×•×Ÿ.',
                features: ['×—×•×–×§ ×’×‘×•×” B-30', '×¢×‘×™×“×•×ª ××¢×•×œ×”'],
                technicalSpecs: { coverage: '××©×ª× ×”', drying: '10 ×©×¢×•×ª', standard: '×ª"×™ 1' },
                stock: 500
            },
            {
                id: 'p3',
                sku: 'YTG-10',
                title: '×‘×œ×•×§ ××™×˜×•× ×’ 10',
                price: 6.5,
                category: '×‘×œ×•×§×™×',
                brand: '××™×˜×•× ×’',
                supplier: '××™×˜×•× ×’ ×™×©×¨××œ',
                image: 'https://placehold.co/400x400/f1f5f9/334155?text=Ytong',
                description: '×‘×œ×•×§ ×œ×‘×Ÿ ××‘×•×“×“ ×ª×¨××™×ª ×•××§×•×¡×˜×™×ª ×œ×‘× ×™×™×ª ××—×™×¦×•×ª ×¤× ×™×.',
                features: ['×‘×™×“×•×“ ×ª×¨××™ ××¢×•×œ×”', '×§×œ ××©×§×œ', '×¢××™×“ ×‘××©'],
                technicalSpecs: { coverage: '10 ×™×—×³ ×œ×"×¨', drying: '-', standard: '×ª"×™ 268' },
                stock: 1200
            }
        ];

        const CATEGORIES = [
            { id: 'all', name: '×”×›×œ', icon: 'LayoutGrid' },
            { id: 'cement', name: '××œ×™×˜×”', icon: 'Component' },
            { id: 'blocks', name: '×‘×œ×•×§×™×', icon: 'Box' },
            { id: 'paint', name: '×¦×‘×¢', icon: 'PaintBucket' },
            { id: 'tools', name: '×›×œ×™×', icon: 'Hammer' }
        ];

        // --- 2. SERVICES ---
        const PHONE_NUMBER = "972508860896";

        const WhatsAppService = {
            shareProduct: (p) => {
                const text = `×”×™×™ ×—.×¡×‘×Ÿ, ×”×ª×¢× ×™×™× ×ª×™ ×‘××•×¦×¨: *${p.title}* (××§"×˜ ${p.sku}). ××©××— ×œ×¤×¨×˜×™×.`;
                window.open(`https://wa.me/${PHONE_NUMBER}?text=${encodeURIComponent(text)}`, '_blank');
            },
            sendOrder: (cart, customer) => {
                let msg = `ğŸ‘‹ *×”×–×× ×” ×—×“×©×” - ×œ×§×•×— ××–×“××Ÿ*\n\n`;
                let total = 0;
                cart.forEach((item, i) => {
                    msg += `${i+1}. ${item.product.title} (x${item.qty})\n`;
                    total += item.product.price * item.qty;
                });
                msg += `\nğŸ’° *×¡×”"×›: â‚ª${total}*\n----------------\nğŸ‘¤ ×©×: ${customer.name}\nğŸ“± × ×™×™×“: ${customer.phone}`;
                if(customer.notes) msg += `\nğŸ“ ×”×¢×¨×•×ª: ${customer.notes}`;
                
                window.open(`https://wa.me/${PHONE_NUMBER}?text=${encodeURIComponent(msg)}`, '_blank');
            }
        };

        // --- 3. COMPONENTS ---

        // ××™×™×§×•×Ÿ ×“×™× ××™ - ×ª×™×§×•×Ÿ ×œ×©×™××•×© ×‘-Lucide Vanilla JS ×‘×ª×•×š React
        const Icon = ({ name, size = 20, className }) => {
            const ref = useRef(null);

            useEffect(() => {
                if (!ref.current || !window.lucide) return;
                
                // × ×™×§×•×™ ×ª×•×›×Ÿ ×§×•×“× (×× ×”×©× ×”×©×ª× ×”)
                ref.current.innerHTML = '';

                // ×‘×“×™×§×” ×× ×”××™×™×§×•×Ÿ ×§×™×™× ×‘×¡×¤×¨×™×™×” ×”×’×œ×•×‘×œ×™×ª
                const iconDef = window.lucide.icons[name];
                if (iconDef) {
                    // ×™×¦×™×¨×ª ××œ×× ×˜ SVG ×‘×××¦×¢×•×ª ×”-API ×©×œ lucide
                    const svg = window.lucide.createElement(iconDef);
                    
                    // ×”×’×“×¨×ª ×××¤×™×™× ×™×
                    svg.setAttribute('width', size);
                    svg.setAttribute('height', size);
                    if (className) svg.setAttribute('class', className);
                    
                    // ×”×•×¡×¤×” ×œ-DOM
                    ref.current.appendChild(svg);
                }
            }, [name, size, className]);

            // ×©×™××•×© ×‘-span ×›×§×•× ×˜×™×™× ×¨ ×œ××™×™×§×•×Ÿ
            return <span ref={ref} style={{ display: 'inline-flex', alignItems: 'center', justifyContent: 'center' }} />;
        };

        // ×¦'××˜×‘×•×˜ ×¦×£ (×’×¨×¡×” ×¨×–×” ×œ××¤×œ×™×§×¦×™×™×ª ×”×œ×§×•×—)
        const ChatWidget = () => {
            const [isOpen, setIsOpen] = useState(false);
            const [msgs, setMsgs] = useState([{role:'bot', text:'××”×œ×Ÿ! ×× ×™ ×”×‘×•×˜ ×©×œ ×¡×‘×Ÿ. ×××ª×™×Ÿ ×‘×ª×•×¨? ×©××œ ××•×ª×™ ×¢×œ ×”××•×¦×¨×™×.'}]);
            const [input, setInput] = useState('');
            const endRef = useRef(null);

            useEffect(() => endRef.current?.scrollIntoView({ behavior: 'smooth' }), [msgs, isOpen]);

            const send = () => {
                if(!input.trim()) return;
                const userMsg = { role: 'user', text: input };
                setMsgs(p => [...p, userMsg]);
                setInput('');
                
                // ×¡×™××•×œ×¦×™×™×ª ×ª×©×•×‘×” ×¤×©×•×˜×” (×‘×¤×¨×•×“×§×©×Ÿ - ×§×¨×™××” ×œ-Firebase/OpenAI)
                setTimeout(() => {
                    let ans = "××¦×˜×¢×¨, ×œ× ×”×‘× ×ª×™. × ×¡×” ×œ×©××•×œ ×¢×œ ××—×™×¨ ××• ××œ××™.";
                    if(userMsg.text.includes('××—×™×¨')) ans = "×”××—×™×¨×™× ×‘×§×˜×œ×•×’ ×¢×“×›× ×™×™×. ×œ×”× ×—×ª ×›××•×ª ×¤× ×” ×œ×“×œ×¤×§.";
                    if(userMsg.text.includes('×©×¢×•×ª')) ans = "×× ×—× ×• ×¤×ª×•×—×™× ×-×” 07:00-17:00.";
                    if(userMsg.text.includes('×›×™×¡×•×™')) ans = "×‘×“×¨×š ×›×œ×œ ×¨×©×•× ×‘××¤×¨×˜ ×”×˜×›× ×™ ×‘×“×£ ×”××•×¦×¨.";
                    setMsgs(p => [...p, { role: 'bot', text: ans }]);
                }, 600);
            };

            return (
                <>
                    <button onClick={() => setIsOpen(true)} className={`fixed bottom-24 left-4 z-40 p-3 bg-white text-saban-600 rounded-full shadow-xl transition-transform ${isOpen ? 'scale-0' : 'scale-100'}`}>
                        <Icon name="Bot" size={28} />
                        <span className="absolute top-0 right-0 w-3 h-3 bg-red-500 rounded-full animate-ping"></span>
                    </button>

                    <AnimatePresence>
                        {isOpen && (
                            <motion.div 
                                initial={{ opacity: 0, y: 50, scale: 0.9 }}
                                animate={{ opacity: 1, y: 0, scale: 1 }}
                                exit={{ opacity: 0, y: 50, scale: 0.9 }}
                                className="fixed bottom-20 left-4 right-4 md:right-auto md:w-80 h-96 bg-white/95 backdrop-blur shadow-2xl rounded-2xl border border-gray-100 z-50 flex flex-col overflow-hidden"
                            >
                                <div className="bg-saban-600 text-white p-3 flex justify-between items-center">
                                    <span className="font-bold flex items-center gap-2"><Icon name="Bot" size={18}/> ×”×¢×•×–×¨ ×©×œ ×¡×‘×Ÿ</span>
                                    <button onClick={() => setIsOpen(false)}><Icon name="X" size={18}/></button>
                                </div>
                                <div className="flex-1 overflow-y-auto p-3 space-y-3 bg-gray-50">
                                    {msgs.map((m, i) => (
                                        <div key={i} className={`flex ${m.role==='user'?'justify-end':'justify-start'}`}>
                                            <div className={`p-2 rounded-xl max-w-[85%] text-sm ${m.role==='user'?'bg-saban-600 text-white rounded-tl-none':'bg-white border text-gray-800 rounded-tr-none'}`}>{m.text}</div>
                                        </div>
                                    ))}
                                    <div ref={endRef}></div>
                                </div>
                                <div className="p-2 bg-white border-t flex gap-2">
                                    <input value={input} onChange={e=>setInput(e.target.value)} onKeyDown={e=>e.key==='Enter'&&send()} placeholder="×©××œ ×©××œ×”..." className="flex-1 bg-gray-100 rounded-full px-3 text-sm focus:outline-none focus:ring-1 focus:ring-saban-500" />
                                    <button onClick={send} className="bg-saban-600 text-white p-2 rounded-full"><Icon name="Send" size={16}/></button>
                                </div>
                            </motion.div>
                        )}
                    </AnimatePresence>
                </>
            );
        };

        // ×ª×¤×¨×™×˜ × ×™×•×•×˜ ×ª×—×ª×•×Ÿ
        const NavBar = ({ cartCount }) => {
            const loc = useLocation();
            const isActive = (path) => loc.pathname === path ? 'text-saban-600' : 'text-gray-400';
            
            return (
                <div className="fixed bottom-0 w-full bg-white glass pb-safe border-t border-gray-100 z-30 h-16 flex justify-around items-center px-2">
                    <Link to="/" className={`flex flex-col items-center gap-1 text-[10px] font-medium ${isActive('/')}`}>
                        <Icon name="Home" size={22} />
                        <span>×¨××©×™</span>
                    </Link>
                    <Link to="/scan" className="flex flex-col items-center justify-center -mt-6">
                        <div className="bg-saban-600 text-white p-3.5 rounded-full shadow-lg shadow-saban-200 active:scale-95 transition">
                            <Icon name="ScanLine" size={24} />
                        </div>
                        <span className="text-[10px] font-bold text-saban-600 mt-1">×¡×¨×•×§</span>
                    </Link>
                    <Link to="/cart" className={`flex flex-col items-center gap-1 text-[10px] font-medium relative ${isActive('/cart')}`}>
                        <Icon name="ShoppingCart" size={22} />
                        {cartCount > 0 && <span className="absolute -top-1 -right-1 bg-red-500 text-white text-[9px] w-4 h-4 flex items-center justify-center rounded-full">{cartCount}</span>}
                        <span>×¢×’×œ×”</span>
                    </Link>
                </div>
            );
        };

        // --- 4. PAGES ---

        const HomePage = () => {
            const [search, setSearch] = useState('');
            const filtered = PRODUCTS.filter(p => p.title.includes(search) || p.sku.includes(search));

            return (
                <div className="pt-4 pb-24 px-4">
                    {/* Header */}
                    <div className="flex justify-between items-center mb-6">
                        <div>
                            <h1 className="text-2xl font-black text-gray-800">×—.×¡×‘×Ÿ</h1>
                            <p className="text-xs text-gray-500">××¡×¤×§×” ×˜×›× ×™×ª ×œ×›×•×œ×</p>
                        </div>
                        <div className="w-10 h-10 rounded-full bg-gray-200 overflow-hidden border border-gray-100">
                             <img src="https://ui-avatars.com/api/?name=Saban&background=0d9488&color=fff" />
                        </div>
                    </div>

                    {/* Search */}
                    <div className="relative mb-6">
                        <Icon name="Search" className="absolute top-3.5 right-4 text-gray-400" size={18} />
                        <input 
                            value={search} onChange={e => setSearch(e.target.value)}
                            className="w-full h-12 pr-12 pl-4 bg-white rounded-2xl shadow-sm border-none ring-1 ring-gray-100 focus:ring-2 focus:ring-saban-500 outline-none transition" 
                            placeholder="×—×™×¤×•×© ××•×¦×¨, ××§×˜..." 
                        />
                    </div>

                    {/* Categories */}
                    {!search && (
                        <div className="mb-8 overflow-x-auto hide-scrollbar">
                            <div className="flex gap-3 w-max px-1 pb-2">
                                {CATEGORIES.map(cat => (
                                    <button key={cat.id} className="flex flex-col items-center justify-center w-20 h-20 bg-white rounded-2xl shadow-sm border border-gray-50 active:scale-95 transition">
                                        <div className="text-saban-600 mb-1"><Icon name={cat.icon} size={22} /></div>
                                        <span className="text-xs font-bold text-gray-600">{cat.name}</span>
                                    </button>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Grid */}
                    <h2 className="font-bold text-gray-800 mb-3">{search ? '×ª×•×¦××•×ª ×—×™×¤×•×©' : '××•×¦×¨×™× ××•×‘×™×œ×™×'}</h2>
                    <div className="grid grid-cols-2 gap-4">
                        {filtered.map(p => (
                            <Link to={`/product/${p.id}`} key={p.id} className="bg-white p-3 rounded-2xl shadow-sm flex flex-col h-full border border-gray-50 active:scale-95 transition">
                                <div className="aspect-square bg-gray-50 rounded-xl mb-3 relative overflow-hidden">
                                    <img src={p.image} className="w-full h-full object-cover mix-blend-multiply" loading="lazy"/>
                                    <div className="absolute top-2 right-2 bg-white/90 backdrop-blur px-2 py-0.5 rounded-full text-[10px] font-bold text-gray-600">{p.brand}</div>
                                </div>
                                <h3 className="font-bold text-sm text-gray-800 leading-tight mb-1 line-clamp-2">{p.title}</h3>
                                <div className="mt-auto flex justify-between items-end">
                                    <span className="text-lg font-black text-saban-600">â‚ª{p.price}</span>
                                    <div className="w-7 h-7 bg-gray-100 rounded-full flex items-center justify-center text-saban-600"><Icon name="Plus" size={14} /></div>
                                </div>
                            </Link>
                        ))}
                    </div>
                </div>
            );
        };

        const ProductPage = ({ addToCart }) => {
            const { id } = useParams();
            const nav = useNavigate();
            const p = PRODUCTS.find(x => x.id === id);

            if(!p) return <div>×œ× × ××¦×</div>;

            return (
                <div className="bg-white min-h-screen pb-24">
                    <div className="relative h-72 bg-gray-100">
                        <img src={p.image} className="w-full h-full object-cover" />
                        <button onClick={() => nav(-1)} className="absolute top-4 right-4 w-10 h-10 bg-white/80 backdrop-blur rounded-full flex items-center justify-center shadow-sm z-10"><Icon name="ArrowRight" /></button>
                    </div>
                    
                    <div className="-mt-6 relative z-10 bg-white rounded-t-3xl p-6 shadow-[0_-10px_30px_rgba(0,0,0,0.05)]">
                        <div className="flex justify-between items-start mb-2">
                            <div>
                                <h1 className="text-2xl font-black text-gray-900 leading-tight mb-1">{p.title}</h1>
                                <p className="text-xs text-gray-400">××§"×˜: {p.sku}</p>
                            </div>
                            <div className="text-2xl font-black text-saban-600">â‚ª{p.price}</div>
                        </div>

                        <div className="grid grid-cols-2 gap-3 my-6">
                            <button onClick={() => WhatsAppService.shareProduct(p)} className="flex items-center justify-center gap-2 py-3 rounded-xl bg-green-50 text-green-700 text-sm font-bold"><Icon name="Share2" size={16}/> ×©×ª×£ ×‘×•×•×˜×¡××¤</button>
                            <button className="flex items-center justify-center gap-2 py-3 rounded-xl bg-gray-50 text-gray-700 text-sm font-bold"><Icon name="FileText" size={16}/> ××¤×¨×˜ ×˜×›× ×™</button>
                        </div>

                        <div className="space-y-6">
                            <section>
                                <h3 className="font-bold text-gray-800 mb-2 text-sm">×ª×™××•×¨</h3>
                                <p className="text-sm text-gray-500 leading-relaxed">{p.description}</p>
                            </section>
                            <section>
                                <h3 className="font-bold text-gray-800 mb-2 text-sm">×ª×›×•× ×•×ª</h3>
                                <ul className="space-y-2">
                                    {p.features.map((f, i) => (
                                        <li key={i} className="flex gap-2 text-sm text-gray-600"><Icon name="Check" size={16} className="text-saban-500 shrink-0"/> {f}</li>
                                    ))}
                                </ul>
                            </section>
                            <section className="bg-gray-50 rounded-xl p-4 border border-gray-100">
                                <h3 className="font-bold text-gray-800 mb-3 text-sm">× ×ª×•× ×™× ×˜×›× ×™×™×</h3>
                                <div className="grid grid-cols-3 gap-2 text-center">
                                    <div className="bg-white p-2 rounded-lg border border-gray-100">
                                        <span className="block text-[10px] text-gray-400">×›×™×¡×•×™</span>
                                        <span className="font-bold text-xs text-gray-700">{p.technicalSpecs.coverage}</span>
                                    </div>
                                    <div className="bg-white p-2 rounded-lg border border-gray-100">
                                        <span className="block text-[10px] text-gray-400">×™×™×‘×•×©</span>
                                        <span className="font-bold text-xs text-gray-700">{p.technicalSpecs.drying}</span>
                                    </div>
                                    <div className="bg-white p-2 rounded-lg border border-gray-100">
                                        <span className="block text-[10px] text-gray-400">×ª×§×Ÿ</span>
                                        <span className="font-bold text-xs text-gray-700">{p.technicalSpecs.standard}</span>
                                    </div>
                                </div>
                            </section>
                        </div>
                    </div>

                    <div className="fixed bottom-0 w-full p-4 bg-white border-t z-20 pb-safe">
                        <button onClick={() => addToCart(p)} className="w-full bg-saban-600 text-white py-3.5 rounded-xl font-bold shadow-lg shadow-saban-200 active:scale-95 transition flex items-center justify-center gap-2">
                            ×”×•×¡×£ ×œ×¢×’×œ×” <Icon name="ShoppingBag" size={18}/>
                        </button>
                    </div>
                </div>
            );
        };

        const CartPage = ({ cart, updateQty, clearCart }) => {
            const [form, setForm] = useState({ name: '', phone: '', notes: '' });
            const total = cart.reduce((acc, i) => acc + (i.product.price * i.qty), 0);

            const send = () => {
                if(!form.name || !form.phone) return alert("×—×•×‘×” ×œ××œ× ×©× ×•×˜×œ×¤×•×Ÿ");
                WhatsAppService.sendOrder(cart, form);
                if(confirm("×”×”×–×× ×” × ×©×œ×—×”? ×œ× ×§×•×ª ×¡×œ?")) clearCart();
            };

            if(!cart.length) return <div className="h-screen flex flex-col items-center justify-center text-gray-400 gap-4"><Icon name="ShoppingCart" size={48} opacity={0.2} /><p>×”×¢×’×œ×” ×¨×™×§×”</p></div>;

            return (
                <div className="pt-6 pb-24 px-4 bg-gray-50 min-h-screen">
                    <h1 className="text-2xl font-black mb-6">×¡×™×›×•× ×”×–×× ×”</h1>
                    <div className="space-y-3 mb-8">
                        {cart.map(item => (
                            <div key={item.product.id} className="bg-white p-3 rounded-xl shadow-sm flex gap-3">
                                <img src={item.product.image} className="w-16 h-16 rounded-lg bg-gray-100 object-cover" />
                                <div className="flex-1">
                                    <h4 className="font-bold text-sm text-gray-800 line-clamp-1">{item.product.title}</h4>
                                    <div className="text-saban-600 font-bold text-sm mt-1">â‚ª{item.product.price * item.qty}</div>
                                </div>
                                <div className="flex flex-col items-end justify-between">
                                    <button onClick={() => updateQty(item.product.id, 0)} className="text-gray-300 hover:text-red-500"><Icon name="Trash2" size={16}/></button>
                                    <div className="flex items-center bg-gray-100 rounded-lg h-8">
                                        <button onClick={() => updateQty(item.product.id, -1)} className="w-8 flex justify-center">-</button>
                                        <span className="text-xs font-bold w-4 text-center">{item.qty}</span>
                                        <button onClick={() => updateQty(item.product.id, 1)} className="w-8 flex justify-center">+</button>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>

                    <div className="bg-white p-5 rounded-2xl shadow-sm space-y-3 mb-6">
                        <h3 className="font-bold text-sm flex gap-2"><div className="w-1 h-4 bg-saban-600 rounded-full"></div> ×¤×¨×˜×™ ×œ×§×•×—</h3>
                        <input value={form.name} onChange={e=>setForm({...form, name:e.target.value})} placeholder="×©× ××œ× *" className="w-full bg-gray-50 p-3 rounded-xl text-sm border-none outline-none focus:ring-1 focus:ring-saban-500"/>
                        <input value={form.phone} onChange={e=>setForm({...form, phone:e.target.value})} type="tel" placeholder="×˜×œ×¤×•×Ÿ × ×™×™×“ *" className="w-full bg-gray-50 p-3 rounded-xl text-sm border-none outline-none focus:ring-1 focus:ring-saban-500"/>
                        <textarea value={form.notes} onChange={e=>setForm({...form, notes:e.target.value})} placeholder="×”×¢×¨×•×ª..." className="w-full bg-gray-50 p-3 rounded-xl text-sm border-none outline-none focus:ring-1 focus:ring-saban-500 h-20"></textarea>
                    </div>

                    <div className="fixed bottom-0 left-0 w-full bg-white p-4 border-t z-20 pb-safe">
                        <div className="flex justify-between mb-2 font-bold text-gray-900"><span>×¡×”"×›:</span><span className="text-xl">â‚ª{total}</span></div>
                        <button onClick={send} className="w-full bg-green-600 text-white py-3.5 rounded-xl font-bold shadow-lg shadow-green-200 active:scale-95 transition flex items-center justify-center gap-2">×©×œ×— ×œ×•×•×˜×¡××¤ <Icon name="Send" size={18}/></button>
                    </div>
                </div>
            );
        };

        const ScannerPage = () => (
            <div className="fixed inset-0 bg-black z-50 flex flex-col items-center justify-center text-white">
                <div className="relative w-64 h-64 border-2 border-saban-500 rounded-3xl overflow-hidden mb-8">
                    <div className="absolute top-0 w-full h-1 bg-red-500 shadow-[0_0_15px_red] animate-[scan_2s_infinite]"></div>
                    <div className="absolute inset-0 flex items-center justify-center text-gray-500/30"><Icon name="ScanLine" size={64}/></div>
                </div>
                <p className="text-gray-400 text-sm mb-8 px-10 text-center">×›×•×•×Ÿ ××ª ×”××¦×œ××” ×œ×‘×¨×§×•×“ ×”××•×¦×¨<br/>(×¡×™××•×œ×¦×™×”)</p>
                <Link to="/" className="bg-white/10 px-6 py-2 rounded-full font-bold text-sm backdrop-blur">×‘×™×˜×•×œ</Link>
                <style>{`@keyframes scan { 0% {top:0} 50% {top:100%} 100% {top:0} }`}</style>
            </div>
        );

        // --- 5. MAIN APP LAYOUT ---

        const App = () => {
            // State
            const [cart, setCart] = useState(() => JSON.parse(localStorage.getItem('saban_cart')||'[]'));
            
            // Sync Cart
            useEffect(() => localStorage.setItem('saban_cart', JSON.stringify(cart)), [cart]);

            const addToCart = (p) => {
                setCart(prev => {
                    const exist = prev.find(i => i.product.id === p.id);
                    if(exist) return prev.map(i => i.product.id === p.id ? {...i, qty: i.qty+1} : i);
                    return [...prev, { product: p, qty: 1 }];
                });
                alert("××•×¦×¨ × ×•×¡×£ ×œ×¢×’×œ×”"); // ×‘×¤×¨×•×“×§×©×Ÿ ×œ×”×—×œ×™×£ ×‘-Toast
            };

            const updateQty = (pid, delta) => {
                setCart(prev => {
                    if(delta === 0) return prev.filter(i => i.product.id !== pid);
                    return prev.map(i => {
                        if(i.product.id === pid) return { ...i, qty: Math.max(0, i.qty + delta) };
                        return i;
                    }).filter(i => i.qty > 0);
                });
            };

            return (
                <HashRouter>
                    <div className="max-w-md mx-auto bg-white min-h-screen shadow-2xl relative overflow-hidden">
                        <Routes>
                            <Route path="/" element={<HomePage />} />
                            <Route path="/product/:id" element={<ProductPage addToCart={addToCart} />} />
                            <Route path="/cart" element={<CartPage cart={cart} updateQty={updateQty} clearCart={()=>setCart([])} />} />
                            <Route path="/scan" element={<ScannerPage />} />
                        </Routes>
                        <ChatWidget />
                        <NavBar cartCount={cart.reduce((a,b)=>a+b.qty,0)} />
                    </div>
                </HashRouter>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>